@startuml LunarFlow user_api C3 Diagram
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Component diagram for User System with Keycloak Integration

Person(user, "Application User", "A user of the LunarFlow application")
System_Ext(keycloak, "Keycloak", "Identity and Access Management")

Boundary(application, "LunarFlow Application") {
    Container(api, "User API", "Java/Quarkus", "Provides user management functionality")
    
    Boundary(apiComponents, "API Components") {
        Component(userResource, "UserResource", "REST Controller", "Exposes user management endpoints")
        Component(keycloakService, "KeycloakService", "Service", "Direct interface to Keycloak user operations")
        Component(userDto, "UserDto", "Data Transfer Object", "Represents user data with role information")
        Component(securityUtils, "SecurityUtils", "Utility", "Handles security checks and role verification")
    }
}

Rel(user, keycloak, "Authenticates via")
Rel(user, api, "Uses")
Rel(api, keycloak, "Verifies tokens")

Rel(userResource, keycloakService, "Uses")
Rel(userResource, securityUtils, "Uses")
Rel(keycloakService, userDto, "Creates")
Rel(keycloakService, keycloak, "Retrieves user data from")
Rel(api, userResource, "Contains")

' Security relationships
Rel(securityUtils, keycloak, "Verifies tokens & roles")

@enduml